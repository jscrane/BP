---
title: "Blood Pressure"
output:
  html_document:
    df_print: paged
---

Read and preprocess latest blood-pressure file.
```{r message=FALSE}
library(lubridate)
```
```{r}
bp <- read.csv(file="bp.csv", header=TRUE, sep=",")
bp$datetime <- paste(bp$date, bp$time)
am <- hour(bp$datetime) < 12
pm <- hour(bp$datetime) >= 12
dates <- as.Date(bp$datetime)
mp <- c(min(bp$dia), max(bp$sys))
cdia <- rgb(0,0,1,1/4)
csys <- rgb(1,0,0,1/4)
cpul <- rgb(0,1,0,1/4)
```
A function to plot blood pressure histograms:
```{r}
plot.blood.pressure <- function(bp, title) {
  hsys <- hist(bp$sys, breaks=10, plot=F)
  hdia <- hist(bp$dia, breaks=10, plot=F)
  mc <- c(0, max(c(hsys$counts, hdia$counts)))
  plot(hdia, col=cdia, xlim=mp, ylim=mc, main = title, xlab = "mmHg")
  plot(hsys, col=csys, xlim=mp, ylim=mc, add=T)
  mdia <- mean(bp$dia)
  msys <- mean(bp$sys)
  abline(v=c(msys, mdia), col=c("red","blue"))
  legend("topright", bty="n", legend=c(paste("dia: ", format(mdia, digits=2)), paste("sys: ", format(msys, digits=2))))
}
```

## Summary

Plot systolic and diastolic pressures for all data points.
```{r}
plot.blood.pressure(bp, "Overall")
```

### Morning
Now the same for morning:
```{r}
plot.blood.pressure(bp[am,], "Morning")
```

### Evening
And evening:
```{r}
plot.blood.pressure(bp[pm,], "Evening")
```

### Over Time

Systolic and diastolic blood pressure over time.
```{r}
plot.dates <- function(dates, points, title, col) {
  cs <- c("lightblue", "blue")
  plot(dates[am], points[am], xlab="Date", ylab="mmHg", main=title, pch=21, col=cs[1], bg=cs[1])
  points(dates[pm], points[pm], pch=21, col=cs[2], bg=cs[2])
  sd <- lm(points~dates)
  abline(sd, col=col)
  legend("bottomright", bty="n", legend=paste("r^2: ", format(summary(sd)$r.squared, digits=2)))
  legend("bottomleft", bty="n", legend=c("am", "pm"), text.col = cs, pt.bg=cs)
}
plot.dates(dates, bp$sys, "Systolic", "red")
plot.dates(dates, bp$dia, "Diastolic", "blue")
```

## Pulse

```{r}
hpul <- hist(bp$pul, breaks=10, plot=F)
plot(hpul, col=cpul, main = "Pulse Overall", xlab = "bpm")
abline(v=mean(bp$pul), col="green")
```

### Morning

```{r}
hpul_am <- hist(bp[am,]$pul, plot=F)
plot(hpul_am, col=cpul, main="Morning", xlab="bpm")
abline(v=mean(bp[am,]$pul), col="green")
```

### Evening

```{r}
hpul_pm <- hist(bp[pm,]$pul, plot=F)
plot(hpul_pm, col=cpul, main="Evening", xlab="bpm")
abline(v=mean(bp[pm,]$pul), col="green")
```

### Over Time

```{r}
plot.dates(dates, bp$pul, "Pulse", "green")
```

## Systolic vs Diastolic Pressure

```{r}
plot(bp$dia, bp$sys, xlab = "Diastolic", ylab="Systolic")
msd <- lm(bp$sys~bp$dia)
abline(msd)
legend("bottomright", bty="n", legend=paste("r^2: ", format(summary(msd)$r.squared, digits=2)))
```


