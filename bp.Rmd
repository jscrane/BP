---
title: "Blood Pressure"
output:
  html_document:
    df_print: paged
---

Read and preprocess latest blood-pressure file.
```{r message=FALSE}
library(lubridate)
```
```{r}
bp <- read.csv(file="bp.csv", header=TRUE, sep=",")
bp$datetime <- paste(bp$date, bp$time)
dates <- as.Date(bp$datetime)
mp <- c(min(bp$dia), max(bp$sys))
cdia <- rgb(0,0,1,1/4)
csys <- rgb(1,0,0,1/4)
cpul <- rgb(0,1,0,1/4)
```
A function to plot blood pressure histograms:
```{r}
plot.blood.pressure <- function(bp) {
  hsys <- hist(bp$sys, breaks=10, plot=F)
  hdia <- hist(bp$dia, breaks=10, plot=F)
  mc <- c(0, max(c(hsys$counts, hdia$counts)))
  plot(hdia, col=cdia, xlim=mp, ylim=mc, main = "Overall", xlab = "mmHg")
  plot(hsys, col=csys, xlim=mp, ylim=mc, add=T)
  mdia <- mean(bp$dia)
  msys <- mean(bp$sys)
  abline(v=c(msys, mdia), col=c("red","blue"))
  legend("topright", bty="n", legend=c(paste("dia: ", format(mdia, digits=2)), paste("sys: ", format(msys, digits=2))))
}
```

## Summary

Plot systolic and diastolic pressures for all data points.
```{r}
plot.blood.pressure(bp)
```

### Morning
Now the same for morning:
```{r}
am <- bp[hour(bp$datetime) < 12,]
plot.blood.pressure(am)
```

### Evening
And evening:
```{r}
pm <- bp[hour(bp$datetime) >= 12,]
plot.blood.pressure(pm)
```

### Over Time

Systolic and diastolic blood pressure over time.
```{r}
plot(dates, bp$sys, xlab="Date", ylab="mmHg", main="Systolic")
sd <- lm(bp$sys~dates)
abline(sd, col="red")
legend("bottomright", bty="n", legend=paste("r^2: ", format(summary(sd)$r.squared, digits=2)))
plot(dates, bp$dia, xlab="Date", ylab="mmHg", main="Diastolic")
dd <- lm(bp$dia~dates)
abline(dd, col="blue")
legend("bottomright", bty="n", legend=paste("r^2: ", format(summary(dd)$r.squared, digits=2)))
```
## Pulse

```{r}
hpul <- hist(bp$pul, breaks=10, plot=F)
plot(hpul, col=cpul, main = "Pulse Overall", xlab = "bpm")
abline(v=mean(bp$pul), col="green")
```

### Morning

```{r}
hpul_am <- hist(am$pul, plot=F)
plot(hpul_am, col=cpul, main="Morning", xlab="bpm")
abline(v=mean(am$pul), col="green")
```

### Evening

```{r}
hpul_pm <- hist(pm$pul, plot=F)
plot(hpul_pm, col=cpul, main="Evening", xlab="bpm")
abline(v=mean(pm$pul), col="green")
```

### Over Time

```{r}
plot(dates, bp$pul, xlab="Date", ylab="bpm", main="Pulse")
pd <- lm(bp$pul~dates)
abline(pd, col="green")
legend("bottomright", bty="n", legend=paste("r^2: ", format(summary(pd)$r.squared, digits=2)))
```

## Systolic vs Diastolic Pressure

```{r}
plot(bp$dia, bp$sys, xlab = "Diastolic", ylab="Systolic")
msd <- lm(bp$sys~bp$dia)
abline(msd)
legend("bottomright", bty="n", legend=paste("r^2: ", format(summary(msd)$r.squared, digits=2)))
```


